<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd">
<web-app>
  <!-- You must include a display name with the web application.  If you do not then when 
       you run your web application on JBoss (or other app server) you will be graced with 
       a NullPointerException from within the NucleusServlet
       
       java.lang.NullPointerException
	          atg.servlet.NameContextManager.initializeSessionNameContext(NameContextManager.java:504)
	          atg.taglib.dspjsp.Utils.checkParentSessionNameContext(Unknown Source)
	          atg.filter.dspjsp.PageFilter.doFilter(Unknown Source)
	          org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:75)
    -->
  <display-name>templates</display-name>

  <!-- FOR APPSERVERS OTHER THAN DAS -->
  <!-- This setting tells JBoss that it needs to manage session replication.  If you 
       deploy this web application on a non-farmed JBoss server you will see this 
       error message in the server console:
       
       13:04:35,751 ERROR [JBossCacheManager] JBossCacheService to Tomcat clustering not found
       13:04:35,751 ERROR [TomcatDeployer] Failed to setup clustering, clustering disabled       

  <distributable/>
    -->
  
  <!-- FOR APPSERVERS OTHER THAN DAS -->
  <!-- 
     This is the name/value of the "parent web application", i.e. the name
     of a web application, which has a SessionNameContextServlet defined in it
     that will define the session scope for this web application. 
     Setting this here allows the child application to share the same session 
     scope with the above application.  Meaning these two apps share session.
     The parent web application OOTB is DafEar.base.
   -->
  <context-param>
    <param-name>atg.session.parentContextName</param-name>
    <param-value>/dyn</param-value>
  </context-param>
  
  
  <!-- FOR APPSERVERS OTHER THAN DAS -->
  <context-param>
    <param-name>atg.dafear.bootstrapContextName</param-name>
    <param-value>/dyn</param-value>
    <description>The name of the DAF bootstrap WAR context.</description>
  </context-param>
  
  
  <!--
	 If context-root is set here, then ServletContextWebAppRegistry will use
	 this setting as the context-root for this WebApp. This must match
	 the context-root setting in application.xml.
  -->
  <context-param>
	  <param-name>context-root</param-name>
	  <param-value>templates</param-value>
  </context-param>
  
  <!-- Turn off preview for this app-->
  <context-param>
    <param-name>atg.preview</param-name>
    <param-value>false</param-value>
  </context-param>

  <!-- We need this because some BIZUI property editors include code like:
       <img src="<c:url context="${initParam['atg.bizui.ContextPath']}"/> -->
  <context-param>
    <param-name>atg.bizui.ContextPath</param-name>
    <param-value>/atg</param-value>
  </context-param>

  <!-- This filter invokes the DAF servlet pipeline.  It is intended to
       eliminate the need for dsp:page tags in JSPs.  (Unfortunately, this
       functionality is not fully implemented as of ATG 7.0, so dsp:page
       tags are also still required.) -->
  <filter>
    <filter-name>PageFilter</filter-name>
    <filter-class>atg.filter.dspjsp.PageFilter</filter-class>
  </filter>   

  <!-- This filter ensures that the project context is properly set for every
       request, so that repository API calls will apply to the correct versions
       of repository items. -->
  <filter>
    <filter-name>ProjectFilter</filter-name>
    <filter-class>atg.epub.servlet.ProjectFilter</filter-class>
    <init-param>
      <param-name>versioningLayerTools</param-name>
      <param-value>ctx:dynamo:/atg/epub/servlet/VersioningLayerTools</param-value>
    </init-param>
  </filter>

  <!-- This filter is responsible for adding full caching headers to static
       content (images, js files, etc.) -->
  <filter>
    <filter-name>AddCacheHeadersFilter</filter-name>
    <filter-class>atg.filter.AddCacheHeadersFilter</filter-class>
    <init-param>
      <param-name>patterns</param-name>
      <param-value>.*\.png,.*\.gif,.*\.jpg,.*\.js,.*\.ico,.*\.css</param-value>
    </init-param>
  </filter>

  <!-- This filter sets the JSTL "fmt" taglib's locale to the current user
       locale for the duration of a request. -->
  <filter>
    <filter-name>UserLocaleFilter</filter-name>
    <filter-class>atg.web.filter.UserLocaleFilter</filter-class>
  </filter>

  <filter-mapping>
    <filter-name>PageFilter</filter-name>
    <url-pattern>*.jsp</url-pattern>
  </filter-mapping>

  <filter-mapping>
    <filter-name>ProjectFilter</filter-name>
    <url-pattern>*.jsp</url-pattern>
  </filter-mapping>

  <filter-mapping>
    <filter-name>AddCacheHeadersFilter</filter-name>
    <url-pattern>/*</url-pattern>
  </filter-mapping>

  <filter-mapping>
    <filter-name>UserLocaleFilter</filter-name>
    <url-pattern>*.jsp</url-pattern>
  </filter-mapping>

  <!-- Configure the Nucleus Servlet. This servlet definition is required in
       each web application that uses Dynamo functionality.  When mapped, it
       exposes the Nucleus component browser, but should not be mapped to any
       paths on a live site. -->
  <servlet>
    <servlet-name>NucleusServlet</servlet-name>
    <servlet-class>atg.nucleus.servlet.NucleusServlet</servlet-class>
    <load-on-startup>1</load-on-startup>
  </servlet>
  
  <welcome-file-list>
    <welcome-file>index.jsp</welcome-file>
  </welcome-file-list>
  
  <taglib>
    <taglib-uri>dsp</taglib-uri>
    <taglib-location>/WEB-INF/tld/dspjspTaglib1_0.tld</taglib-location>
  </taglib>

  <taglib>
    <taglib-uri>dspel</taglib-uri>
    <taglib-location>/WEB-INF/tld/dspjspELTaglib1_0.tld</taglib-location>
  </taglib>
  
  <taglib>
    <taglib-uri>c</taglib-uri>
    <taglib-location>/WEB-INF/c.tld</taglib-location>
  </taglib>
</web-app>