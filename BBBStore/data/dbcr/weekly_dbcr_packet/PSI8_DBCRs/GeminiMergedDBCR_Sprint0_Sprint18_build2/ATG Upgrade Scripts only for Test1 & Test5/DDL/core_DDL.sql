-- BUILD VERSION : PSI8 RELEASE SPRINT14 BUILD1
SET ECHO ON;
SET DEFINE OFF;
CREATE UNIQUE INDEX BBB_CORE.INV_CATLOC_IDX ON BBB_CORE.DCS_INVENTORY (CATALOG_REF_ID,LOCATION_ID);
CREATE UNIQUE INDEX BBB_CORE.DPS_USER_U1 ON BBB_CORE.DPS_USER (LOGIN,REALM_ID);

ALTER TABLE BBB_CORE.DSS_SERVER_ID MODIFY SERVER_ID VARCHAR2(80);
CREATE TABLE BBB_CORE.SRCH_CONFIG (
	CONFIG_PATH	VARCHAR2(254)	NOT NULL,
	CONTENT_ID	VARCHAR2(40)	NOT NULL,
	GENERATION	NUMBER(10)	NOT NULL,
	CLAIMED_GENERATION	NUMBER(10)	NULL,
	NXT_INC_GENERATION	NUMBER(10)	NULL,
	UNIQ_SERVER_ID	VARCHAR2(254)	NULL,
	LAST_ACTIVITY	TIMESTAMP	NULL,
	LAST_FULL_INDEX	TIMESTAMP	NULL,
	LAST_INCR_INDEX	TIMESTAMP	NULL
,CONSTRAINT SRCH_CONFIG_P PRIMARY KEY (CONFIG_PATH,CONTENT_ID));

CREATE TABLE BBB_CORE.SRCH_CONFIG_REPO (
	ID	VARCHAR2(40)	NOT NULL,
	CONFIG_PATH	VARCHAR2(254)	NOT NULL,
	CONTENT_ID	VARCHAR2(40)	NOT NULL,
	REPOSITORY_PATH	VARCHAR2(254)	NOT NULL
,CONSTRAINT SRCH_CONFIG_REPO_P PRIMARY KEY (ID));

CREATE TABLE BBB_CORE.SRCH_UPDATE_QUEUE (
	REPOSITORY_ID	VARCHAR2(254)	NOT NULL,
	CONFIG_REPO_ID	VARCHAR2(40)	NOT NULL,
	GENERATION	NUMBER(10)	NOT NULL,
	ITEM_DESC_NAME	VARCHAR2(64)	NOT NULL,
	CHANGE_TYPE	NUMBER(10)	NOT NULL
,CONSTRAINT SRCH_UP_QUEUE_P PRIMARY KEY (REPOSITORY_ID,CONFIG_REPO_ID,GENERATION,ITEM_DESC_NAME)
,CONSTRAINT SRCH_UPQ_CFRP_F1 FOREIGN KEY (CONFIG_REPO_ID) REFERENCES BBB_CORE.SRCH_CONFIG_REPO (ID));

CREATE INDEX BBB_CORE.SRCH_UPDATEQUE1_X ON BBB_CORE.SRCH_UPDATE_QUEUE (CONFIG_REPO_ID);
-- ADD THE SEARCH_UPDATE_QUEUE... USED BY THE INCREMENTALLOADER TO TRACKREPOSITORY CHANGES.

CREATE TABLE BBB_CORE.SRCH_UPDATE_VQUEUE (
	ID	VARCHAR2(40)	NOT NULL,
	CONFIG_PATH	VARCHAR2(254)	NOT NULL,
	GENERATION	NUMBER(10)	NOT NULL,
	REPOSITORY_PATH	VARCHAR2(254)	NOT NULL,
	ITEM_DESC_NAME	VARCHAR2(64)	NOT NULL,
	REPOSITORY_ID	VARCHAR2(254)	NOT NULL,
	CHANGE_TYPE	NUMBER(10)	NOT NULL,
	DEV_LINE_ID	VARCHAR2(40)	NOT NULL,
	ASSET_VERSION	NUMBER(10)	NOT NULL
,CONSTRAINT SRCH_UP_VQUEUE_P PRIMARY KEY (ID));

CREATE INDEX BBB_CORE.SRCH_UP_VQUEUE ON BBB_CORE.SRCH_UPDATE_VQUEUE (CONFIG_PATH,GENERATION,REPOSITORY_PATH,ITEM_DESC_NAME,REPOSITORY_ID);

CREATE VIEW BBB_CORE.BBB_FACET_FACET_VALUE 
AS 
SELECT DISTINCT A.FACET_ID, FACET_VALUE_ID, FACET_VALUE, DESCRIPTION 
FROM BBB_CORE.BBB_FACET_SKU A, BBB_CORE.BBB_FACET_TYPES B 
WHERE A.FACET_ID=B.FACET_ID
AND A.FACET_VALUE != 'N/A';


CREATE TABLE BBB_CORE.BBB_RANGE_DIMENSION
(
  ID VARCHAR2(40 BYTE) PRIMARY KEY,
  DIM_NAME VARCHAR2(40 BYTE) NOT NULL,
  DIM_SPEC VARCHAR2(40 BYTE),
  PARENT_SPEC VARCHAR2(5 BYTE),
  DISPLAY_ORDER INTEGER,
  LOWER_BOUND INTEGER,
  LOWER_BOUND_INCLUSIVE NUMBER(1,0),
  UPPER_BOUND INTEGER,  
  UPPER_BOUND_INCLUSIVE NUMBER(1,0)  
);
-- Sprint 15.1

CREATE TABLE BBB_CORE.BBB_DIM_ORDER 
( 
CATEGORY_ID VARCHAR2(40), 
RANK VARCHAR2(50), 
PRIMARY KEY(CATEGORY_ID) 
); 

COMMIT;